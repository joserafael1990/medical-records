# Database Schema Validation Report

## Summary
Comparison between current database models and the `02_insert_master_data.sql` script.

---

## ‚úÖ 1. AppointmentType (appointment_types)

### Current Model:
```python
- id (Integer, PK)
- name (String(50), unique)
- is_active (Boolean)
- created_at (DateTime)
```

### Script Expects:
```sql
- id
- name
- active  ‚ö†Ô∏è MISMATCH
- created_at
```

**Status:** ‚ö†Ô∏è **COLUMN NAME MISMATCH**
- Model uses: `is_active`
- Script uses: `active`

**Fix:** Update script to use `is_active` instead of `active`

---

## ‚úÖ 2. Country (countries)

### Current Model:
```python
- id (Integer, PK)
- name (String(100))
- phone_code (String(5))
- is_active (Boolean)
- created_at (DateTime)
```

### Script Expects:
```sql
- id
- name
- phone_code
- active  ‚ö†Ô∏è MISMATCH
- created_at
```

**Status:** ‚ö†Ô∏è **COLUMN NAME MISMATCH**
- Model uses: `is_active`
- Script uses: `active`

**Fix:** Update script to use `is_active` instead of `active`

---

## ‚úÖ 3. State (states)

### Current Model:
```python
- id (Integer, PK)
- name (String(100))
- country_id (Integer, FK)
- is_active (Boolean)
- created_at (DateTime)
```

### Script Expects:
```sql
- id
- name
- country_id
- active  ‚ö†Ô∏è MISMATCH
- created_at
```

**Status:** ‚ö†Ô∏è **COLUMN NAME MISMATCH**
- Model uses: `is_active`
- Script uses: `active`

**Fix:** Update script to use `is_active` instead of `active`

---

## ‚úÖ 4. Specialty (medical_specialties)

### Current Model:
```python
- id (Integer, PK)
- name (String(100))
- is_active (Boolean)
- created_at (DateTime)
```

### Script Expects:
```sql
- id
- name
- active  ‚ö†Ô∏è MISMATCH
- created_at
```

**Status:** ‚ö†Ô∏è **COLUMN NAME MISMATCH**
- Model uses: `is_active`
- Script uses: `active`

**Fix:** Update script to use `is_active` instead of `active`

---

## ‚ùå 5. DiagnosisCategory (diagnosis_categories)

### Current Model:
**DOES NOT EXIST** - Removed from codebase (see comment in `models/diagnosis.py`)

### Script Expects:
```sql
- id
- name
- code
- description
- active
- created_at
```

**Status:** ‚ùå **TABLE REMOVED**
- Comment in code: "DiagnosisCategory removed - not required by law (NOM-004-SSA3-2012, NOM-024-SSA3-2012)"

**Fix:** Remove this section from the script

---

## ‚úÖ 6. StudyCategory (study_categories)

### Current Model:
```python
- id (Integer, PK)
- name (String(100))
- is_active (Boolean)
- created_at (DateTime)
```

### Script Expects:
```sql
(Referenced in script line 737: \i db_setup/09_insert_study_categories.sql)
```

**Status:** ‚úÖ **EXISTS** - Need to check `09_insert_study_categories.sql` for column compatibility

---

## üìã Action Items

### Critical Issues:
1. **Column name mismatch:** All tables use `is_active` but script uses `active`
2. **DiagnosisCategory table removed:** Script tries to insert into non-existent table

### Recommended Fix:
Create a corrected version of `02_insert_master_data.sql` with:
- Replace all `active` with `is_active`
- Remove the DiagnosisCategory section (lines 748-796)
- Keep everything else as-is

### Tables to Populate (after fix):
‚úÖ appointment_types  
‚úÖ countries  
‚úÖ states  
‚úÖ medical_specialties  
‚úÖ emergency_relationships  
‚úÖ study_categories (via 09_insert_study_categories.sql)  
‚ùå diagnosis_categories (SKIP - table doesn't exist)
