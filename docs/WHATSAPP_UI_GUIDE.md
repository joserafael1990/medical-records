# ğŸ“± WhatsApp - GuÃ­a de Uso en la Interfaz

## ğŸ¯ UbicaciÃ³n de los Botones de WhatsApp

### 1. **Recordatorios de Citas** ğŸ“…

**UbicaciÃ³n:** `Dashboard â†’ Agenda`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AGENDA                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ğŸ“… Cita: 10:00 AM - Juan PÃ©rez                             â”‚
â”‚     Estado: Confirmada                                       â”‚
â”‚     Tipo: Primera vez                                        â”‚
â”‚                                                               â”‚
â”‚     [ğŸ“± WhatsApp]  [âœï¸ Editar]  [âŒ Cancelar]               â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ğŸ“… Cita: 11:30 AM - MarÃ­a GarcÃ­a                           â”‚
â”‚     Estado: Confirmada                                       â”‚
â”‚     Tipo: Seguimiento                                        â”‚
â”‚                                                               â”‚
â”‚     [ğŸ“± WhatsApp]  [âœï¸ Editar]  [âŒ Cancelar]               â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **CaracterÃ­sticas:**
- âœ… **Un botÃ³n por cada cita**
- âœ… **Solo visible para citas confirmadas**
- âœ… **BotÃ³n verde con icono de WhatsApp**
- âœ… **EnvÃ­a recordatorio de ESA cita especÃ­fica**

#### **Flujo de Uso:**
1. Usuario ve la lista de citas del dÃ­a
2. Identifica la cita para la cual quiere enviar recordatorio
3. Click en botÃ³n **"WhatsApp"** de esa cita
4. El sistema envÃ­a el recordatorio **con los datos de esa cita**
5. NotificaciÃ³n de Ã©xito aparece en pantalla
6. El paciente recibe el WhatsApp con:
   - TÃ­tulo del doctor (Dr/Dra)
   - Nombre completo del doctor
   - Hora y fecha de **esa cita especÃ­fica**

---

### 2. **Notificaciones de Resultados de Estudios** ğŸ§ª

**UbicaciÃ³n:** `Nueva Consulta â†’ Estudios ClÃ­nicos Previos del Paciente`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Estudios ClÃ­nicos Previos del Paciente              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ğŸ§ª Hemograma Completo                                       â”‚
â”‚     Tipo: Laboratorio                                        â”‚
â”‚     Estado: âœ… Completado                                    â”‚
â”‚     Solicitado: 15/01/2024                                   â”‚
â”‚                                                               â”‚
â”‚     [ğŸ‘ï¸ Ver Archivo]  [ğŸ“± Notificar]                        â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ğŸ§ª RadiografÃ­a de TÃ³rax                                     â”‚
â”‚     Tipo: ImagenologÃ­a                                       â”‚
â”‚     Estado: â³ Pendiente                                     â”‚
â”‚     Solicitado: 18/01/2024                                   â”‚
â”‚                                                               â”‚
â”‚     [ğŸ“¤ Cargar Archivo]  [âœ… Marcar Completado]              â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **CaracterÃ­sticas:**
- âœ… **Solo visible para estudios completados**
- âœ… **Requiere que el estudio tenga archivo cargado**
- âœ… **BotÃ³n verde "Notificar" con icono de WhatsApp**

#### **Flujo de Uso:**
1. Doctor abre una consulta
2. Selecciona un paciente
3. Ve los estudios clÃ­nicos previos del paciente
4. Identifica un estudio completado
5. Click en botÃ³n **"Notificar"**
6. El paciente recibe notificaciÃ³n de que sus resultados estÃ¡n listos

---

## ğŸ“± Ejemplo de Mensaje de WhatsApp

### **Recordatorio de Cita:**

```
Hola,

Recordatorio de tu cita mÃ©dica con Dr Rafael GarcÃ­a.

Hora programada: 10:30 AM del 25 de Enero

Por favor confirma tu asistencia.
```

**Nota:** Los parÃ¡metros se ajustan automÃ¡ticamente segÃºn:
- GÃ©nero del doctor (Dr/Dra)
- Nombre completo del doctor desde su perfil
- Fecha y hora de la cita especÃ­fica

---

## ğŸ¨ Estados Visuales

### **BotÃ³n Normal:**
```
[ğŸ“± WhatsApp]  â† Verde, clickeable
```

### **BotÃ³n Enviando:**
```
[â³ Enviando...]  â† Deshabilitado, mostrando progreso
```

### **NotificaciÃ³n de Ã‰xito:**
```
âœ… Recordatorio enviado por WhatsApp exitosamente
```

### **NotificaciÃ³n de Error:**
```
âŒ Error al enviar recordatorio por WhatsApp
```

---

## âš™ï¸ ConfiguraciÃ³n

### **Â¿CuÃ¡ndo aparece el botÃ³n?**

#### **Para Citas:**
- âœ… La cita debe tener estado: **"Confirmada"**
- âœ… La cita debe tener un ID vÃ¡lido
- âœ… El paciente debe tener nÃºmero de telÃ©fono registrado

#### **Para Estudios:**
- âœ… El estudio debe tener estado: **"Completado"**
- âœ… El estudio debe tener archivo cargado (`file_path`)
- âœ… El paciente debe tener nÃºmero de telÃ©fono registrado

---

## ğŸ”§ Troubleshooting

### **No veo el botÃ³n de WhatsApp en mis citas**

**Posibles causas:**
1. La cita no estÃ¡ en estado "Confirmada"
2. La cita no tiene ID (es una cita temporal)
3. El frontend no se ha actualizado

**SoluciÃ³n:**
```bash
docker-compose restart typescript-frontend
```

### **El botÃ³n aparece pero no envÃ­a el mensaje**

**Posibles causas:**
1. El paciente no tiene nÃºmero de telÃ©fono
2. Las credenciales de WhatsApp no estÃ¡n configuradas
3. Error de red

**VerificaciÃ³n:**
```bash
./test-whatsapp.sh
```

### **El mensaje se envÃ­a pero el paciente no lo recibe**

**Posibles causas:**
1. El nÃºmero no estÃ¡ registrado en el dashboard de Meta
2. El nÃºmero estÃ¡ en formato incorrecto
3. El paciente ha bloqueado el nÃºmero de WhatsApp Business

**SoluciÃ³n:**
1. Ve a: https://developers.facebook.com/apps/
2. WhatsApp â†’ API Setup â†’ Manage phone number list
3. Verifica que el nÃºmero estÃ© en la lista

---

## ğŸ“Š Monitoreo

### **Ver logs del backend:**
```bash
docker logs medical-records-main-python-backend-1 --tail 50 | grep -i whatsapp
```

### **Ver estado de mensajes:**
Los logs mostrarÃ¡n:
```
ğŸ“± Sending WhatsApp reminder for appointment: 123
âœ… WhatsApp sent successfully to 525579449672
```

---

## ğŸ¯ Mejores PrÃ¡cticas

1. **EnvÃ­a recordatorios con tiempo:**
   - Ideal: 24 horas antes de la cita
   - MÃ­nimo: 2 horas antes

2. **Verifica antes de enviar:**
   - Confirma que el nÃºmero de telÃ©fono sea correcto
   - Verifica que la fecha/hora de la cita sea correcta

3. **No envÃ­es mÃºltiples recordatorios:**
   - Un recordatorio por cita es suficiente
   - Evita spam para no molestar al paciente

4. **Modo Desarrollo:**
   - Recuerda que tienes 1,000 mensajes gratis/mes
   - Los nÃºmeros deben estar verificados en el dashboard

---

## ğŸš€ Atajos de Teclado (PrÃ³ximamente)

**Planeados para futuras versiones:**
- `Ctrl + W` - Enviar WhatsApp desde cita seleccionada
- `Ctrl + Shift + W` - Enviar WhatsApp a todas las citas del dÃ­a

---

## ğŸ“ Soporte

Si tienes problemas:
1. Revisa `docs/WHATSAPP_TROUBLESHOOTING.md`
2. Ejecuta `./test-whatsapp.sh`
3. Verifica configuraciÃ³n en `compose.yaml`
4. Consulta logs del backend

---

**Â¡Disfruta enviando recordatorios a tus pacientes! ğŸ“±âœ¨**

